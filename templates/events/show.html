{% extends "base.html" %}

{% block title %}{{ event.event_name }}{% endblock %}

{% block content %}
<div class="page-header animate-fade-in">
    <nav class="breadcrumb-nav">
        <a href="/events" class="breadcrumb-link">← 返回活動列表</a>
    </nav>
</div>

<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
    <!-- Event Hero Section -->
    <div class="event-hero">
        <div class="event-hero-content">
            <div class="event-hero-badge">
                <i class="bi bi-calendar-event"></i>
                活動詳情
            </div>

            <h1 class="event-hero-title">{{ event.event_name }}</h1>

            <div class="event-hero-meta">
                <div class="event-hero-meta-item">
                    <span class="event-meta-label">日期</span>
                    <span class="event-meta-value">{{ event.event_date.format("%Y年%m月%d日") }}</span>
                </div>

                {% match event.event_location %}
                    {% when Some with (loc) %}
                        <div class="event-hero-meta-item">
                            <span class="event-meta-label">地點</span>
                            <span class="event-meta-value">{{ loc }}</span>
                        </div>
                    {% when None %}
                        <div class="event-hero-meta-item">
                            <span class="event-meta-label">地點</span>
                            <span class="event-meta-value">線上活動</span>
                        </div>
                {% endmatch %}

                <div class="event-hero-meta-item">
                    <span class="event-meta-label">頻道</span>
                    <span class="event-meta-value">{{ issuer.channel_name }}</span>
                </div>
            </div>

            {% match event.event_description %}
                {% when Some with (desc) %}
                    <div style="margin-top: 1.5rem;">
                        <span class="event-meta-label">活動描述</span>
                        <p style="margin-top: 0.5rem; font-size: 1rem; color: var(--color-slate); line-height: 1.7;">
                            {{ desc }}
                        </p>
                    </div>
                {% when None %}
            {% endmatch %}
        </div>
    </div>

    <!-- Stats and Actions Grid -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
        <!-- Statistics Panel -->
        <div class="info-panel animate-fade-in stagger-1">
            <h3 class="panel-heading">
                <i class="bi bi-bar-chart-fill" style="color: var(--color-cyan); margin-right: 0.5rem;"></i>
                驗證統計
            </h3>

            <div class="event-stats-grid">
                <div class="event-stat-card">
                    <span class="event-stat-value">{{ stats.total_scans }}</span>
                    <span class="event-stat-label">總掃描次數</span>
                </div>

                <div class="event-stat-card">
                    <span class="event-stat-value">{{ stats.unique_cards }}</span>
                    <span class="event-stat-label">唯一卡片</span>
                </div>

                <div class="event-stat-card">
                    <span class="event-stat-value stat-success">{{ stats.successful_scans }}</span>
                    <span class="event-stat-label">成功驗證</span>
                </div>

                <div class="event-stat-card">
                    <span class="event-stat-value stat-error">{{ stats.failed_scans }}</span>
                    <span class="event-stat-label">驗證失敗</span>
                </div>
            </div>
        </div>

        <!-- Actions Panel -->
        <div class="info-panel animate-fade-in stagger-2">
            <h3 class="panel-heading">
                <i class="bi bi-lightning-fill" style="color: var(--color-cyan); margin-right: 0.5rem;"></i>
                快速操作
            </h3>

            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <a href="/verify/{{ event.id }}/scanner" class="btn btn-primary" style="width: 100%;">
                    <i class="bi bi-qr-code-scan"></i>
                    開始掃描器
                </a>

                <a href="/verify/{{ event.id }}/history" class="btn btn-secondary" style="width: 100%;">
                    <i class="bi bi-clock-history"></i>
                    查看歷史記錄
                </a>

                <a href="/events/{{ event.id }}/edit" class="btn btn-ghost" style="width: 100%;">
                    <i class="bi bi-pencil"></i>
                    編輯活動
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Info Cards -->
    <div class="card-grid animate-fade-in stagger-3" style="margin-top: 2rem;">
        <div class="content-card">
            <div class="card-corner"></div>
            <div class="card-content">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                    <i class="bi bi-info-circle-fill" style="font-size: 1.5rem; color: var(--color-cyan);"></i>
                    <h3 class="card-title" style="margin: 0; font-size: 1.25rem;">活動資訊</h3>
                </div>
                <dl class="info-list">
                    <dt>活動名稱</dt>
                    <dd>{{ event.event_name }}</dd>

                    <dt>活動日期</dt>
                    <dd>{{ event.event_date.format("%Y年%m月%d日 %A") }}</dd>

                    <dt>發行者</dt>
                    <dd>{{ issuer.channel_name }}</dd>

                    <dt>活動 ID</dt>
                    <dd style="font-family: 'Courier New', monospace; font-size: 0.875rem;">{{ event.id }}</dd>
                </dl>
            </div>
        </div>

        <div class="content-card">
            <div class="card-corner"></div>
            <div class="card-content">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                    <i class="bi bi-clipboard-check-fill" style="font-size: 1.5rem; color: var(--color-amber);"></i>
                    <h3 class="card-title" style="margin: 0; font-size: 1.25rem;">驗證摘要</h3>
                </div>
                <dl class="info-list">
                    <dt>總計掃描</dt>
                    <dd>{{ stats.total_scans }} 次</dd>

                    <dt>成功率</dt>
                    <dd>
                        {% match stats.success_rate_label() %}
                            {% when Some with (rate) %}
                                {{ rate }}%
                            {% when None %}
                                N/A
                        {% endmatch %}
                    </dd>

                    <dt>唯一訪客</dt>
                    <dd>{{ stats.unique_cards }} 人</dd>
                </dl>
            </div>
        </div>
    </div>
</div>
{% endblock %}
